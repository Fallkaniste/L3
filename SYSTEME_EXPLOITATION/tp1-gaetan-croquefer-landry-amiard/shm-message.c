#include "shm-message.h"
#include <string.h>
#include <time.h>
#include <stdio.h>
#include <errno.h>

int shm_message_copy(shm_message_t message_source, shm_message_t *message_target)
{
  if(message_target!=NULL && shm_message_set_text(message_target, message_source.text)==0 && shm_message_set_name(message_target, message_source.name)==0)
  {
    return 0;
  }
  return -1;
}

void shm_message_empty(shm_message_t *message)
{
  strcpy(message->name, "");
  strcpy(message->text, "");
}

int shm_message_is_empty(shm_message_t message)
{
  if (strlen(message.name)==0 && strlen(message.text)==0)
  {
    return 1;
  }
  return 0;
}

void shm_message_print(shm_message_t message)
{
  time_t rawtime;
  struct tm* actualDate;

  time(&rawtime);
  actualDate=localtime(&rawtime);

  printf("%d-%02d-%02d %02d:%02d:%02d: ",1900+actualDate->tm_year, actualDate->tm_mon, actualDate->tm_mday, actualDate->tm_hour, actualDate->tm_min, actualDate->tm_sec);
  printf("%s: %s\n", message.name, message.text);
}

int shm_message_set_name(shm_message_t *message, const char *name)
{
  if(message!=NULL)
  {
    if((message->text==NULL || strlen(message->name)==0) && strlen(name)<=SHM_MESSAGE_NAME_SIZE)
    {
        strcpy(message->name, name);
        return 0;
    }
    else if(strlen(name)>SHM_MESSAGE_NAME_SIZE)
    {
      errno = 32;
    }
    else
    {
      errno = 33;
    }
  }
  return -1;
}

int shm_message_set_text(shm_message_t *message, const char *text)
{
  if(message!=NULL)
  {
    if((message->text==NULL || strlen(message->text)==0) && strlen(text)<=SHM_MESSAGE_TEXT_SIZE)
    {
        strcpy(message->text, text);
        return 0;
    }
    else if(strlen(text)>SHM_MESSAGE_TEXT_SIZE)
    {
      errno = 31;
    }
    else
    {
      errno = 30;
    }
  }
  return -1;
}
