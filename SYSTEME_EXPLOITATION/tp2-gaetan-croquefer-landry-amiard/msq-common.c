#include "msq-common.h"

void printError(void* nullPtr, ... )
{
  char* format=NULL;
  va_list args;
  switch (errno)
  {
    case ENOENT :
      format="%s:%s:%d: Unable to create the System V IPC key from the \"%s\" pathname and the \"%ld\" project identifier.\n";
      break;
    case EID :
      format="%s:%s:%d: Unable to get the identifier of the System V shared memory segment from the \"0x%x\" key.\n";
      break;
    case EINVAL :
      format="%s:%s:%d: Unable to get the adress of the System V shared memory segment from the \"%d\" identifier.\n";
      break;
    case ENAN :
      format="%s:%s:%d: \"%s\" is not a number.\n";
      break;
    case EMSGTYP :
      format="%s:%s:%d: Unable to set the \"%s\" type.\n";
      break;
    case EMSGTXT :
      format="%s:%s:%d: Unable to set \"%s\" as message text.\n";
      break;
    case EOOF:
      format="%s:%s:%d: At least one of the numbers you entered is outside the range of an int.\n";
      break;
    case EMN:
      format="%s:%s:%d: Unable to set the \"%ld\" message type because its value is less than or equal to \"0\".\n";
      break;
    default:
      fprintf(stderr, "Unknown error code: %d\n", errno);
      exit(1);
  }
  va_start (args, nullPtr);
  vfprintf (stderr, format, args);
  va_end (args);

  if (errno!=EMN)
  {
    exit(1);
  }
}

long stringToLong(char* optarg)
{
  char* endptr=NULL;
  long value=strtol(optarg,&endptr,10);

  if (endptr != optarg+strlen(optarg))
  {
    errno=ENAN;
    printError(NULL, argv0, __FILE__, __LINE__, optarg);
  }
  if(value>=INT_MAX || value<=INT_MIN)
  {
    errno=EOOF;
    printError(NULL,argv0, __FILE__, __LINE__);
  }
  return value;
}
