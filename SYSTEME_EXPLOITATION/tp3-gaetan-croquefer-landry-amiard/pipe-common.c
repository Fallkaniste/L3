#include "pipe-common.h"

void printError(void* nullPtr, ...)
{
  char* format=NULL;
  va_list args;

  switch(errno)
  {
    case ENAN:
      format="%s:%s:%d: \"%s\" is not a number.\n";
      break;
    case EMN:
      format="%s:%s:%d: Unable to set the \"%d\" PID because its value is less than \"0\".\n";
      break;
    case EMSGPID:
      format="%s:%s:%d: Unable to set the \"%d\" PID.\n";
      break;
    case EMSGTXT:
      format="%s:%s:%d: Unable to set the \"%s\" message text.\n";
      break;
    case EMT:
      format="%s:%s:%d: Unable to set the \"%s\" message text because its \"%d\" size is greater than \"%d\".\n";
      break;
    case EOOF:
      format="%s:%s:%d: \"%s\" is outside the range.\n";
      break;
    case EUO:
      format="%s:%s:%d: \"%c\" is not a valid option.\n";
      break;
    case EMA:
      format="%s:%s:%d: Missing argument for the \"%c\" option.\n";
      break;
    default:
      fprintf(stderr, "Unknown error code: %d\n", errno);
      exit(EXIT_FAILURE);
  }

  va_start(args, nullPtr);
  vfprintf(stderr, format, args);
  va_end (args);

  if(errno!=EMN && errno!=EMT)
  {
    exit(EXIT_FAILURE);
  }
}

int stringToInt(char* optarg)
{
  char* endptr=NULL;
  long value=strtol(optarg, &endptr, 10);

  if (endptr!=optarg+strlen(optarg))
  {
    errno=ENAN;
    printError(NULL, argv0, __FILE__, __LINE__, optarg);
  }
  if(value>=INT_MAX||value<=INT_MIN)
  {
    errno=EOOF;
    printError(NULL, argv0, __FILE__, __LINE__, optarg);
  }
  return (int)value;
}

long stringToLong(char* optarg)
{
  char* endptr=NULL;
  long value=strtol(optarg, &endptr, 10);

  if (endptr!=optarg+strlen(optarg))
  {
    errno=ENAN;
    printError(NULL, argv0, __FILE__, __LINE__, optarg);
  }
  if(value>=LONG_MAX||value<=LONG_MIN)
  {
    errno=EOOF;
    printError(NULL, argv0, __FILE__, __LINE__, optarg);
  }
  return value;
}
