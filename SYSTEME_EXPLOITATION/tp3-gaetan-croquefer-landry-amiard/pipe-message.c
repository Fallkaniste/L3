#include "pipe-common.h"

void pipe_message_print(pipe_message_t message, const char *prefix)
{
  time_t rawtime;
  struct tm* actualDate;

  time(&rawtime);
  actualDate=localtime(&rawtime);

  printf("%d-%02d-%02d %02d:%02d:%02d: ", 1900+actualDate->tm_year, actualDate->tm_mon, actualDate->tm_mday, actualDate->tm_hour, actualDate->tm_min, actualDate->tm_sec);
  printf("%d: %s\n", message.pid, message.text);
}

int pipe_message_set_text(pipe_message_t *message, const char *text)
{
  if(strlen(text)>PIPE_MESSAGE_TEXT_SIZE)
  {
    errno=EMT;
    printError(NULL, argv0,  __FILE__,  __LINE__, optarg, strlen(optarg), PIPE_MESSAGE_TEXT_SIZE);
    errno=EMSGTXT;
    return -1;
  }
  strcpy(message->text, text);
  return 0;
}

int pipe_message_set_pid(pipe_message_t *message, pid_t pid)
{
  if(pid<0)
  {
    errno=EMN;
    printError(NULL, argv0, __FILE__, __LINE__, pid);
    errno=EMSGPID;
    return -1;
  }
  message->pid=pid;
  return 0;
}
